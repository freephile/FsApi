completely overhauled for compatibility with MW 1.32.x
